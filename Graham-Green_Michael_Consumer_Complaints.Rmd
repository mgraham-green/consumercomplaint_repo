---
title: "CFPB Student Loan Complaints in New England (2020)"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
    social: [ "twitter", "facebook", "menu" ]
    theme: united
---

```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(lubridate)
library(janitor)
library(readxl)
library(writexl)
library(DT)
library(dplyr)
library(ggplot2)
library(bbplot)
library(ggthemes)

complaints <- readRDS("/Users/michaelgraham-green/Downloads/complaints.rds")

complaints_NE <- complaints %>% 
  filter(product == 'Student loan', state == c('MA', 'ME', 'NH', 'VT', 'CT', 'RI')) %>% count(state)

complaints_date <- complaints %>% 
  filter(product == 'Student loan', state == c('MA', 'ME', 'NH', 'VT', 'CT', 'RI')) %>% count(mm_yy_sent_to_company) %>% extract(mm_yy_sent_to_company, c("Month", "2020"), "([[:alnum:]]+) ([[:alnum:]]+)")
```

Column {data-width=650}
-----------------------------------------------------------------------

### Breaking Down New England Student Loan Complaints to CFPB by State

```{r}
ggplot2::ggplot(data = complaints_NE, aes(x = state, y = n)) +
    geom_bar(stat = "identity", fill = "#cc0000") +
  geom_text(aes(label=n), position=position_dodge(width=0.9), vjust=-0.25) + 
  labs(title = "Complaints About Student Loans by State",
              subtitle = "2020",
              caption = "Data source: Consumer Financial Protection Bureau",
              x = "State", y = "# of Complaints") +
  theme_economist() 
```

Column {data-width=350}
-----------------------------------------------------------------------

### Timeline of New England Student Loan Complaint Filing Dates

```{r}
ggplot2::ggplot(data = complaints_date, aes(x = factor(Month, level=c('Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec')), y = n, group = 1)) +
  geom_line(color="#cc0000") +
  geom_point() + 
  labs(title = "Complaints Over 2020",
              caption = "Data source: Consumer Financial Protection Bureau",
              x = "Month", y = "# of Complaints") +
  theme_economist()
```

### Breakdown of Complaints by Issue Area

```{r}
DT::datatable((complaints) %>%
  filter(product == 'Student loan', state == c('MA', 'ME', 'NH', 'VT', 'CT', 'RI')) %>% 
  count(issue, sub_issue, sort = TRUE),colnames=c('Issue', 'Subissue','Number of Complaints'), options = list(
  bPaginate = FALSE 
))
```

